<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#050505">
    <title>Vault OS</title>
    <link rel="manifest" href="manifest.json">
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <script src="[https://unpkg.com/lucide@latest](https://unpkg.com/lucide@latest)"></script>
    <style>
        @import url('[https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap)');
        :root { --bg-dark: #050505; --card-glass: rgba(23, 23, 23, 0.9); }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: white; margin: 0; user-select: none; -webkit-tap-highlight-color: transparent; overscroll-behavior: none; }
        .app-card { background: var(--card-glass); border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(20px); border-radius: 28px; }
        .btn-press:active { transform: scale(0.96); }
        .safe-top { padding-top: env(safe-area-inset-top); }
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen pb-24 safe-top">
    <div class="max-w-md mx-auto px-6">
        <header class="flex justify-between items-center py-6">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                    <i data-lucide="shield-check" class="text-white w-7 h-7"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black tracking-tight uppercase italic">Vault_OS</h1>
                    <div class="flex items-center gap-1">
                        <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>
                        <span class="text-[8px] font-bold text-neutral-500 uppercase tracking-widest">Android_Link_Active</span>
                    </div>
                </div>
            </div>
            <button onclick="toggleConfig()" class="p-3 bg-neutral-900 rounded-2xl border border-white/5 btn-press">
                <i data-lucide="settings-2" class="w-5 h-5 text-neutral-400"></i>
            </button>
        </header>

        <div class="app-card p-8 mb-6 text-center">
            <p class="text-[10px] font-black text-neutral-500 uppercase tracking-[0.2em] mb-4">Check-in Protocolo</p>
            <div id="next-date" class="text-4xl font-mono font-black tracking-tighter mb-6 text-white">--/--/----</div>
            <button onclick="checkLife()" class="w-full bg-white text-black py-4 rounded-2xl font-black text-xs uppercase tracking-widest btn-press">REPORTE DE VIDA</button>
        </div>

        <div id="vault-list" class="space-y-3"></div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 h-20 bg-neutral-950/80 backdrop-blur-xl border-t border-white/5 flex items-center justify-around px-10 z-40">
        <button onclick="location.reload()" class="text-blue-500 flex flex-col items-center gap-1">
            <i data-lucide="layout-grid" class="w-6 h-6"></i>
            <span class="text-[8px] font-bold uppercase">Dashboard</span>
        </button>
        <button onclick="toggleConfig()" class="text-neutral-600 flex flex-col items-center gap-1">
            <i data-lucide="cloud-cog" class="w-6 h-6"></i>
            <span class="text-[8px] font-bold uppercase">Cloud</span>
        </button>
        <button onclick="openAddModal()" class="w-12 h-12 bg-white text-black rounded-full -mt-10 flex items-center justify-center shadow-2xl btn-press">
            <i data-lucide="plus" class="w-6 h-6"></i>
        </button>
    </nav>

    <div id="modal-config" class="fixed inset-0 bg-black z-50 hidden flex flex-col p-10">
        <div class="flex-1 flex flex-col justify-center text-center">
            <h3 class="text-2xl font-black mb-8 uppercase italic">Configuración Cloud</h3>
            <div class="space-y-4">
                <input id="cfg-token" type="password" placeholder="GitHub Token" class="w-full bg-neutral-900 border border-white/5 p-5 rounded-2xl text-sm text-center">
                <input id="cfg-gist" type="text" placeholder="Gist ID" class="w-full bg-neutral-900 border border-white/5 p-5 rounded-2xl text-sm text-center">
                <button onclick="saveConfig()" class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl text-xs uppercase btn-press">Vincular</button>
            </div>
        </div>
        <button onclick="toggleConfig()" class="py-10 text-neutral-600 font-bold text-[10px] uppercase text-center">Cerrar</button>
    </div>

    <div id="modal-add" class="fixed inset-0 bg-black/90 z-50 hidden flex items-end">
        <div class="w-full bg-neutral-900 rounded-t-[2.5rem] p-8 pb-12">
            <h3 class="font-black text-xl mb-6 uppercase">Nuevo Registro</h3>
            <div class="space-y-4">
                <input id="new-site" type="text" placeholder="Sitio" class="w-full bg-black border border-white/5 p-5 rounded-2xl text-sm">
                <input id="new-pass" type="password" placeholder="Contraseña" class="w-full bg-black border border-white/5 p-5 rounded-2xl text-sm">
                <button onclick="saveEntry()" class="w-full bg-white text-black font-black py-4 rounded-2xl text-[10px] uppercase btn-press">Guardar</button>
                <button onclick="closeAddModal()" class="w-full text-neutral-500 font-bold text-[10px] uppercase pt-2">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW Fail', err));
            });
        }
        let state = { passwords: [], settings: { nextCheck: Date.now() + 604800000 } };
        let config = JSON.parse(localStorage.getItem('gh_vault_v2')) || { token: '', gistId: '' };
        let visiblePass = {};

        async function sync(dataToSave = null) {
            if (!config.token || !config.gistId) return;
            try {
                const url = `https://api.github.com/gists/${config.gistId}`;
                const response = await fetch(url, {
                    method: dataToSave ? 'PATCH' : 'GET',
                    headers: { 'Authorization': `token ${config.token}`, 'Content-Type': 'application/json' },
                    body: dataToSave ? JSON.stringify({ files: { "vault_data.json": { content: JSON.stringify(dataToSave) } } }) : null
                });
                if (response.ok) {
                    const result = await response.json();
                    state = JSON.parse(result.files["vault_data.json"].content);
                    render();
                }
            } catch (e) { console.error(e); }
        }

        function render() {
            document.getElementById('next-date').textContent = new Date(state.settings.nextCheck).toLocaleDateString();
            const list = document.getElementById('vault-list');
            list.innerHTML = state.passwords.length === 0 ? '<div class="text-center py-10 opacity-20 text-[10px] font-black uppercase tracking-widest">Bóveda vacía</div>' : '';
            state.passwords.forEach(p => {
                const isVisible = visiblePass[p.id];
                list.innerHTML += `<div class="app-card p-5 flex items-center justify-between btn-press" onclick="togglePass(${p.id})"><div><div class="text-[8px] font-black text-neutral-600 uppercase mb-1">${p.site}</div><div class="font-mono text-sm tracking-widest">${isVisible ? p.pass : '••••••••'}</div></div><button onclick="event.stopPropagation(); deleteEntry(${p.id})" class="p-2 text-neutral-800"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div>`;
            });
            lucide.createIcons();
        }

        function saveConfig() {
            config.token = document.getElementById('cfg-token').value.trim();
            config.gistId = document.getElementById('cfg-gist').value.trim();
            localStorage.setItem('gh_vault_v2', JSON.stringify(config));
            toggleConfig();
            sync();
        }

        function saveEntry() {
            const site = document.getElementById('new-site').value;
            const pass = document.getElementById('new-pass').value;
            if(!site || !pass) return;
            state.passwords.push({ id: Date.now(), site, pass });
            sync(state);
            closeAddModal();
        }

        function deleteEntry(id) {
            if(confirm("¿Eliminar?")) {
                state.passwords = state.passwords.filter(x => x.id !== id);
                sync(state);
            }
        }

        function checkLife() {
            const pin = prompt("PIN:");
            if(pin === "1234") {
                state.settings.nextCheck = Date.now() + 604800000;
                sync(state);
            }
        }

        function toggleConfig() { document.getElementById('modal-config').classList.toggle('hidden'); }
        function openAddModal() { document.getElementById('modal-add').classList.remove('hidden'); }
        function closeAddModal() { document.getElementById('modal-add').classList.add('hidden'); }
        function togglePass(id) { visiblePass[id] = !visiblePass[id]; render(); }

        window.onload = () => { lucide.createIcons(); if(config.token) sync(); };
    </script>
</body>
</html>
